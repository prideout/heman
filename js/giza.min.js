var GIZA=GIZA||{REVISION:"0"};GIZA.init=function(t,n){GIZA.saveGizaContext&&GIZA.saveGizaContext(),window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,t=t||GIZA.startCanvas||document.getElementsByTagName("canvas")[0];var e=window.devicePixelRatio||1,r=t.clientWidth,i=t.clientHeight,a=r/i;t.width=r*e,t.height=i*e,n=n||{preserveDrawingBuffer:!1,antialias:!0};var o=GIZA.createContext(t,n);if(!o){var s=document.createElement("p");return s.classList.add("error"),s.innerHTML="Alas, your browser does not support WebGL.",t.parentNode.replaceChild(s,t),null}GIZA.context=o,GIZA.pixelScale=e,GIZA.canvas=t,GIZA.aspect=a,GIZA.timeOffset=0;var u=["context","canvas","aspect","drawHooks","animation","paused","timeOffset","pauseTime","mouse"];return GIZA.currentGizaContext=GIZA.extract(GIZA,u),GIZA.saveGizaContext=function(){GIZA.currentGizaContext&&GIZA.merge(GIZA.currentGizaContext,GIZA,u)},GIZA.setGizaContext=function(t){GIZA.saveGizaContext(),GIZA.currentGizaContext=t,GIZA.merge(GIZA,t)},GIZA.gizaContexts=GIZA.gizaContexts||[],GIZA.gizaContexts.push(GIZA.currentGizaContext),window.onresize=function(){GIZA.refreshSize();for(var t=0;t<GIZA.gizaContexts.length;t++)GIZA.refreshSize(GIZA.gizaContexts[t])},GIZA.mouseinit(),o},GIZA.refreshSize=function(t){t=t||GIZA;var n=t.canvas.clientWidth,e=t.canvas.clientHeight;t.aspect=n/e,t.canvas.width=n*GIZA.pixelScale,t.canvas.height=e*GIZA.pixelScale},GIZA.createContext=function(t,n){for(var e=null,r="webgl experimental-webgl webkit-3d moz-webgl".split(" "),i=0;i<r.length&&!e;i++)try{e=t.getContext(r[i],n)}catch(a){}return e};var GIZA=GIZA||{};GIZA.flatten=function(t){var n,e,r,i;for(e=[],r=0,i=t.length;i>r;r++)n=t[r],n instanceof Array?e=e.concat(GIZA.flatten(n)):e.push(n);return e},GIZA.flattenTo=function(t,n,e){e=e||0;for(var r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)n[e++]=t[r][i];return e},GIZA.format=function(t,n){return t.replace(/{([^{}]*)}/g,function(t,e){var r=n[e];return"string"==typeof r||"number"==typeof r?r:t})},GIZA.merge=function(t,n,e){if(e){for(var r=0;r<e.length;r++){var i=e[r];t[i]=n[i]}return t}for(var a in n)t[a]=n[a];return t},GIZA.clone=function(t){var n=function(t){return t===Object(t)};return n(t)?Array.isArray(t)?t.slice():GIZA.merge({},t):t},GIZA.extract=function(t,n){for(var e={},r=0;r<n.length;r++){var i=n[r];e[i]=t[i]}return e},GIZA.joinBuffers=function(t,n){n=n||t[0].constructor;for(var e=t.reduce(function(t,n){return t+n.length},0),r=new n(e),i=0,a=0;a<t.length;a++)r.set(t[a],i),i+=t[a].length;return r},GIZA.interleaveBuffers=function(t,n){for(var e=null,r=t.reduce(function(t,r){var i=r.byteLength/n;return i!=Math.floor(i)?void console.error("interleaveBuffers has a badly-sized input: "+r.length+" / "+n):null!=e&&i!=e?void console.error("interleaveBuffers has inconsistent inputs: "+e+", "+i):(e=i,t+r.byteLength)},0),i=new ArrayBuffer(r),a=new Uint8Array(i),o=0,s=0,u=0;e>u;u++)t.forEach(function(t){var e=new Uint8Array(t,s,n);a.set(e,o),o+=n}),s+=n;return i},GIZA.download=function(t,n,e,r){var i=new XMLHttpRequest;if(i.open("GET",t,!0),"json"==e)var a=function(){i.responseText&&n(JSON.parse(i.responseText))};else{i.responseType="arraybuffer";var a=function(){i.response&&n(i.response)}}i.onload=a,i.onerror=r,i.send(null)},GIZA.grabCanvas=function(){var t=GIZA.canvas.toDataURL("image/png");return window.open(t,"_blank"),window.focus(),t};var GIZA=GIZA||{};GIZA.drawHooks=[],GIZA.animate=function(t){GIZA.animation=t;var n=GIZA.currentGizaContext,e=function(t){if(GIZA.setGizaContext(n),!GIZA.paused){var r=GIZA.context;t+=GIZA.timeOffset;for(var i=0;i<GIZA.drawHooks.length;i++)GIZA.drawHooks[i](t);r.viewport(0,0,GIZA.canvas.width,GIZA.canvas.height),GIZA.animation(t),err=r.getError(),err==r.NO_ERROR?GIZA._anim=window.requestAnimationFrame(e,GIZA.canvas):console.error("WebGL error during draw cycle: ",err)}};e(GIZA.getTime())},GIZA.shutdown=function(){GIZA.paused=!1,GIZA._anim&&(window.cancelAnimationFrame(GIZA._anim),GIZA._anim=void 0),GIZA.mouseshutdown()},GIZA.pause=function(){GIZA.paused=!0,GIZA.pauseTime=GIZA.getTime(),window.cancelAnimationFrame(GIZA._anim),GIZA._anim=void 0},GIZA.resume=function(){if(GIZA.paused){var t=GIZA.getTime(),n=t-GIZA.pauseTime;GIZA.timeOffset-=n,GIZA.paused=!1,GIZA.animate(GIZA.animation)}},GIZA.restart=function(){var t=GIZA.getTime()-GIZA.timeOffset;GIZA.timeOffset=-t,GIZA.pauseTime=0},GIZA.getTime=function(){var t;return t="mozAnimationStartTime"in window?window.mozAnimationStartTime:window.performance&&"now"in window.performance?window.performance.now():Date.now(),t+GIZA.timeOffset};var GIZA=GIZA||{};GIZA.compile=function(t,n){var e={};for(var r in t){var i=t[r];e[r]=GIZA.compileProgram(i.vs,i.fs,i.attribs||n)}return e},GIZA.compileProgram=function(t,n,e){var r=GIZA.context,i=GIZA.compileShader(t,r.VERTEX_SHADER),a=GIZA.compileShader(n,r.FRAGMENT_SHADER),o=r.createProgram();r.attachShader(o,i),r.attachShader(o,a);for(key in e)value=e[key],r.bindAttribLocation(o,value,key);r.linkProgram(o);var s=r.getProgramParameter(o,r.LINK_STATUS);s||console.error("Could not link: "+r.getProgramInfoLog(o));for(var u=r.getProgramParameter(o,r.ACTIVE_UNIFORMS),c=0;u>c;c++){var l=r.getActiveUniform(o,c).name;o[l]=r.getUniformLocation(o,l)}return o},GIZA.compileShader=function(t,n){for(var e=GIZA.context,r="",i=0;i<t.length;i++)if("function"!=typeof t[i]){var a=document.getElementById(t[i]);a?r+=a.innerHTML:console.error("Cannot find shader string named "+t[i])}else r+=t[i].toString().replace(/^[^\/]+\/\*!?/,"").replace(/\*\/[^\/]+$/,"");var o=e.createShader(n);e.shaderSource(o,r),e.compileShader(o);var s=e.getShaderParameter(o,e.COMPILE_STATUS);return s||console.error("GLSL error:\n"+e.getShaderInfoLog(o)),o};var GIZA=GIZA||{};GIZA.BufferView=function(t){if(!(this instanceof GIZA.BufferView))return new GIZA.BufferView(t);this.offsets={},this.dims={};var n=0;for(var e in t){var r=t[e][0],i=t[e][1],a=i*r.BYTES_PER_ELEMENT;this.offsets[e]=n,this.dims[e]=i,n+=a}this.elementSize=n,this.strides={};for(var e in t){var r=t[e][0],o=this.elementSize/r.BYTES_PER_ELEMENT;o!=Math.floor(o)&&console.error("BufferView alignment error: '"+e+"' is "+r.BYTES_PER_ELEMENT+" bytes but element size is "+this.elementSize+" bytes."),this.strides[e]=o}this.setArray=function(n){this.numElements=n.byteLength/this.elementSize,this.typedArrays={};for(var e in t){var r=t[e][0];this.typedArrays[e]=new r(n,this.offsets[e])}},this.makeBuffer=function(t){var n=new ArrayBuffer(t*this.elementSize);return this.setArray(n),n},this.iterator=function(t){var n=this;return{index:0,clone:function(){var e=n.iterator(t);return e.index=this.index,e},next:function(){if(this.index>=n.numElements)return null;var e=n.getElement(this.index++);return t?e[t]:e}}},this.getElement=function(n){retval={};for(var e in t){var r=n*this.strides[e];retval[e]=this.typedArrays[e].subarray(r,r+this.dims[e])}return retval.set=function(n){for(var e in n)if(e in t){var r=n[e];Array.isArray(r)?retval[e].set(r):retval[e][0]=r}},retval}};var GIZA=GIZA||{};GIZA.Vector2={make:function(t,n){return[t,n]},direction:function(t,n){return this.normalized(this.subtract(n,t))},equivalent:function(t,n,e){return e=e||1e-6,this.distanceSquared(t,n)<e},copy:function(t){return this.make(t[0],t[1])},set:function(t,n){return t[0]=n[0],t[1]=n[1],t},normalize:function(t){var n=1/this.length(t);return this.scale(t,n)},normalized:function(t){var n=1/this.length(t);return this.scaled(t,n)},translate:function(t,n,e){return e?(t[0]+=n,t[1]+=e):(t[0]+=n[0],t[1]+=n[1]),t},translated:function(t,n,e){var r=this.make();return e?(r[0]=t[0]+n,r[1]=t[1]+e):(r[0]=t[0]+n[0],r[1]=t[1]+n[1]),r},scale:function(t,n){return t[0]*=n,t[1]*=n,t},scaled:function(t,n){return this.make(n*t[0],n*t[1])},negate:function(t){return this.scale(t,-1)},negated:function(t){return this.scaled(t,-1)},length:function(t){return Math.sqrt(this.dot(t,t))},lengthSquared:function(t){return this.dot(t,t)},distance:function(t,n){var e=this.subtract(t,n);return this.length(e)},distanceSquared:function(t,n){var e=this.subtract(t,n);return this.lengthSquared(e)},cross:function(t,n){return t[0]*n[1]-t[1]*n[0]},withinTriangle:function(t,n,e,r){var i=this.subtract(e,n),a=this.subtract(r,e),o=this.subtract(n,r),s=this.subtract(t,n),u=this.subtract(t,e),c=this.subtract(t,r),n=this.cross(i,s),e=this.cross(a,u),r=this.cross(o,c);return 0>n&&0>e&&0>r?!0:n>0&&e>0&&r>0?!0:!1},subtract:function(t,n){return this.make(t[0]-n[0],t[1]-n[1])},add:function(t,n){return this.make(t[0]+n[0],t[1]+n[1])},dot:function(t,n){return t[0]*n[0]+t[1]*n[1]},lerp:function(t,n,e){return t=this.scaled(t,1-e),n=this.scaled(n,e),this.add(t,n)},perp:function(t){return this.make(-t[1],t[0])}},GIZA.Vector3={make:function(t,n,e){return[t,n,e]},direction:function(t,n){return this.normalized(this.subtract(n,t))},equivalent:function(t,n,e){return e=e||1e-6,this.distanceSquared(t,n)<e},copy:function(t){return this.make(t[0],t[1],t[2])},set:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t},normalize:function(t){var n=1/this.length(t);return this.scale(t,n)},normalized:function(t){var n=1/this.length(t);return this.scaled(t,n)},translate:function(t,n,e,r){return e?(t[0]+=n,t[1]+=e,t[2]+=r):(t[0]+=n[0],t[1]+=n[1],t[2]+=n[2]),t},translated:function(t,n,e,r){var i=this.make();return e?(i[0]=t[0]+n,i[1]=t[1]+e,i[2]=t[2]+r):(i[0]=t[0]+n[0],i[1]=t[1]+n[1],i[2]=t[2]+n[2]),i},scale:function(t,n){return t[0]*=n,t[1]*=n,t[2]*=n,t},scaled:function(t,n){return this.make(n*t[0],n*t[1],n*t[2])},negate:function(t){return this.scale(t,-1)},negated:function(t){return this.scaled(t,-1)},length:function(t){return Math.sqrt(this.dot(t,t))},lengthSquared:function(t){return this.dot(t,t)},distance:function(t,n){var e=this.subtract(t,n);return this.length(e)},distanceSquared:function(t,n){var e=this.subtract(t,n);return this.lengthSquared(e)},cross:function(t,n){return this.make(t[1]*n[2]-t[2]*n[1],t[2]*n[0]-t[0]*n[2],t[0]*n[1]-t[1]*n[0])},subtract:function(t,n){return this.make(t[0]-n[0],t[1]-n[1],t[2]-n[2])},add:function(t,n){return this.make(t[0]+n[0],t[1]+n[1],t[2]+n[2])},dot:function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]},lerp:function(t,n,e){return t=this.scaled(t,1-e),n=this.scaled(n,e),this.add(t,n)},perp:function(t){var n=this.cross(t,this.make(1,0,0));return this.lengthSquared(n)<.01&&(n=this.cross(t,this.make(0,1,0))),this.normalize(n)}},GIZA.Vector4={make:function(t,n,e,r){return[t,n,e,r]},equivalent:function(t,n,e){return e=e||1e-6,this.distanceSquared(t,n)<e},copy:function(t){return this.make(t[0],t[1],t[2],t[3])},set:function(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t},normalize:function(t){var n=1/this.length(t);return this.scale(t,n)},normalized:function(t){var n=1/this.length(t);return this.scaled(t,n)},translate:function(t,n,e,r,i){return e?(t[0]+=n,t[1]+=e,t[2]+=r,t[3]+=i):(t[0]+=n[0],t[1]+=n[1],t[2]+=n[2],t[3]+=n[3]),t},translated:function(t,n,e,r,i){var a=this.make();return e?(a[0]=t[0]+n,a[1]=t[1]+e,a[2]=t[2]+r,a[3]=t[3]+i):(a[0]=t[0]+n[0],a[1]=t[1]+n[1],a[2]=t[2]+n[2],a[3]=t[3]+n[3]),a},scale:function(t,n){return t[0]*=n,t[1]*=n,t[2]*=n,t[3]*=n,t},scaled:function(t,n){return this.make(n*t[0],n*t[1],n*t[2],n*t[3])},negate:function(t){return this.scale(t,-1)},negated:function(t){return this.scaled(t,-1)},length:function(t){return Math.sqrt(this.dot(t,t))},lengthSquared:function(t){return this.dot(t,t)},distance:function(t,n){var e=this.subtract(t,n);return this.length(e)},distanceSquared:function(t,n){var e=this.subtract(t,n);return this.lengthSquared(e)},subtract:function(t,n){return this.make(t[0]-n[0],t[1]-n[1],t[2]-n[2],t[3]-n[3])},add:function(t,n){return this.make(t[0]+n[0],t[1]+n[1],t[2]+n[2],t[3]+n[3])},dot:function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]},lerp:function(t,n,e){return t=this.scaled(t,1-e),n=this.scaled(n,e),this.add(t,n)}};var GIZA=GIZA||{};GIZA.Bounds={min:[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE],max:[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],aabb:function(t){for(var n=GIZA.Vector3,e={min:n.copy(this.max),max:n.copy(this.min)},r=0;r<t.length;r+=3)e.min[0]=Math.min(t[r+0],e.min[0]),e.min[1]=Math.min(t[r+1],e.min[1]),e.min[2]=Math.min(t[r+2],e.min[2]),e.max[0]=Math.max(t[r+0],e.max[0]),e.max[1]=Math.max(t[r+1],e.max[1]),e.max[2]=Math.max(t[r+2],e.max[2]);return e},size:function(t){var n=GIZA.Vector3;return n.subtract(t.max,t.min)},extent:function(t){var n=this.size(t);return Math.max(Math.max(n[0],n[1]),n[2])},center:function(t){var n=GIZA.Vector3;return n.lerp(t.min,t.max,.5)}};var GIZA=GIZA||{};GIZA.Matrix4={make:function(){if(0==arguments.length)return self.identity();if(4==arguments.length){var t=arguments;return this.make(t[0][0],t[0][1],t[0][2],t[0][3],t[1][0],t[1][1],t[1][2],t[1][3],t[2][0],t[2][1],t[2][2],t[2][3],t[3][0],t[3][1],t[3][2],t[3][3])}if(16==arguments.length)return Array.prototype.slice.call(arguments);if(1==arguments.length){var t=arguments[0];if(16==t.length)return t.slice(0);if(4==t.length)return this.make(t[0][0],t[0][1],t[0][2],t[0][3],t[1][0],t[1][1],t[1][2],t[1][3],t[2][0],t[2][1],t[2][2],t[2][3],t[3][0],t[3][1],t[3][2],t[3][3]);if(9==t.length)return this.make(t[0],t[1],t[2],0,t[3],t[4],t[5],0,t[6],t[7],t[8],0,0,0,0,1)}else console.error("GIZA.Matrix4 has wrong number of arguments")},makeBasis:function(t,n,e){return this.make(t[0],t[1],t[2],0,n[0],n[1],n[2],0,e[0],e[1],e[2],0,0,0,0,1)},copy:function(t){return this.make(t)},identity:function(){return this.make(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},equivalent:function(t,n,e){e=e||1e-6;for(var r=0;16>r;r++)if(Math.abs(t[r]-n[r])>e)return!1;return!0},set:function(t,n){for(var e=0;16>e;e++)t[e]=n[e];return t},lookAt:function(t,n,e){var r=GIZA.Vector3;e=r.normalized(e);var i=r.normalize(r.subtract(t,n)),a=r.normalize(r.cross(i,e)),o=r.normalize(r.cross(a,i)),s=this.transpose(this.makeBasis(a,o,i));return s=this.translate(s,r.negated(t))},frustum:function(t,n,e,r,i,a){var o=2*i/(n-t),s=2*i/(r-e),u=(n+t)/(n-t),c=(r+e)/(r-e),l=-(a+i)/(a-i),f=-2*a*i/(a-i);return this.transpose(this.make(o,0,u,0,0,s,c,0,0,0,l,f,0,0,-1,0))},orthographic:function(t,n,e,r,i,a){var o=n-t,s=e-r,u=a-i,c=(n+t)/o,l=(e+r)/s,f=(a+i)/u;return this.transpose(this.make(2/o,0,0,-c,0,2/s,0,-l,0,0,-2/u,-f,0,0,0,1))},perspective:function(t,n,e,r){var i=e*Math.tan(t*Math.PI/360),a=-i,o=a*n,s=i*n;return this.frustum(o,s,a,i,e,r)},translation:function(t,n,e){return this.translated(this.identity(),t,n,e)},translate:function(t,n,e,r){var i=n;return"undefined"!=typeof e&&(i=[n,e,r]),t[12]=t[0]*i[0]+t[4]*i[1]+t[8]*i[2]+t[12],t[13]=t[1]*i[0]+t[5]*i[1]+t[9]*i[2]+t[13],t[14]=t[2]*i[0]+t[6]*i[1]+t[10]*i[2]+t[14],t[15]=t[3]*i[0]+t[7]*i[1]+t[11]*i[2]+t[15],t},translated:function(t,n,e,r){var i=this.copy(t);return this.translate(i,n,e,r)},row:function(t,n){return GIZA.Vector4.make(t[n],t[n+4],t[n+8],t[n+12])},column:function(t,n){return GIZA.Vector4.make(t[4*n],t[4*n+1],t[4*n+2],t[4*n+3])},multiply:function(t,n){if(4==n.length)return GIZA.Vector4.make(t[0]*n[0]+t[4]*n[1]+t[8]*n[2]+t[12]*n[3],t[1]*n[0]+t[5]*n[1]+t[9]*n[2]+t[13]*n[3],t[2]*n[0]+t[6]*n[1]+t[10]*n[2]+t[14]*n[3],t[3]*n[0]+t[7]*n[1]+t[11]*n[2]+t[15]*n[3]);if(16==n.length){var e=this.row(t,0),r=this.row(t,1),i=this.row(t,2),a=this.row(t,3),o=this.column(n,0),s=this.column(n,1),u=this.column(n,2),c=this.column(n,3),l=GIZA.Vector4,t=GIZA.Matrix4.make(l.dot(e,o),l.dot(e,s),l.dot(e,u),l.dot(e,c),l.dot(r,o),l.dot(r,s),l.dot(r,u),l.dot(r,c),l.dot(i,o),l.dot(i,s),l.dot(i,u),l.dot(i,c),l.dot(a,o),l.dot(a,s),l.dot(a,u),l.dot(a,c));return this.transposed(t)}throw new Error("I can only multiply a M4 with a V4 or a M4")},rotationX:function(t){var n=Math.cos(t),e=Math.sin(t);return this.make(1,0,0,0,0,n,-e,0,0,e,n,0,0,0,0,1)},rotationY:function(t){var n=Math.cos(t),e=Math.sin(t);return this.make(n,0,e,0,0,1,0,0,-e,0,n,0,0,0,0,1)},rotationZ:function(t){var n=Math.cos(t),e=Math.sin(t);return this.make(n,-e,0,0,e,n,0,0,0,0,1,0,0,0,0,1)},rotateX:function(t,n){var e=t[4],r=t[5],i=t[6],a=t[7],o=t[8],s=t[9],u=t[10],c=t[11],l=Math.cos(n),f=Math.sin(n);return t[4]=l*e+f*o,t[5]=l*r+f*s,t[6]=l*i+f*u,t[7]=l*a+f*c,t[8]=l*o-f*e,t[9]=l*s-f*r,t[10]=l*u-f*i,t[11]=l*c-f*a,t},rotateY:function(t,n){var e=t,r=e[0],i=e[1],a=e[2],o=e[3],s=e[8],u=e[9],c=e[10],l=e[11],f=Math.cos(n),h=Math.sin(n);return e[0]=f*r-h*s,e[1]=f*i-h*u,e[2]=f*a-h*c,e[3]=f*o-h*l,e[8]=f*s+h*r,e[9]=f*u+h*i,e[10]=f*c+h*a,e[11]=f*l+h*o,e},rotateZ:function(t,n){var e=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],l=Math.cos(n),f=Math.sin(n);return t[0]=l*e+f*o,t[1]=l*r+f*s,t[2]=l*i+f*u,t[3]=l*a+f*c,t[4]=l*o-f*e,t[5]=l*s-f*r,t[6]=l*u-f*i,t[7]=l*c-f*a,t},rotateAxis:function(t,n,e){var r=n[0],i=n[1],a=n[2],o=Math.sqrt(r*r+i*i+a*a);r/=o,i/=o,a/=o;var s=r*r,u=i*i,c=a*a,l=Math.cos(e),f=Math.sin(e),h=1-l,m=r*i*h,A=r*a*h,d=i*a*h,v=r*f,g=i*f,I=a*f,G=s+(1-s)*l,Z=m+I,p=A-g,w=m-I,k=u+(1-u)*l,y=d+v,M=A+g,S=d-v,b=c+(1-c)*l,x=t[0],T=t[1],E=t[2],L=t[3],z=t[4],q=t[5],V=t[6],P=t[7],C=t[8],F=t[9],R=t[10],O=t[11];return t[0]=G*x+Z*z+p*C,t[1]=G*T+Z*q+p*F,t[2]=G*E+Z*V+p*R,t[3]=G*L+Z*P+p*O,t[4]=w*x+k*z+y*C,t[5]=w*T+k*q+y*F,t[6]=w*E+k*V+y*R,t[7]=w*L+k*P+y*O,t[8]=M*x+S*z+b*C,t[9]=M*T+S*q+b*F,t[10]=M*E+S*V+b*R,t[11]=M*L+S*P+b*O,t},scale:function(t){var n,e,r;return 3==t.length?(n=t[0],e=t[1],r=t[2]):n=e=r=t,this.make(n,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1)},scaled:function(t,n,e,r){var i=this.copy(t);return this.scale(i,n,e,r)},transpose:function(t){var n=this.transposed(t);return this.set(t,n),t},transposed:function(t){return this.make(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])},rotatedX:function(t,n){var e=this.copy(t);return this.rotateX(e,n)},rotatedY:function(t,n){var e=this.copy(t);return this.rotateY(e,n)},rotatedZ:function(t,n){var e=this.copy(t);return this.rotateZ(e,n)},stringify:function(t){return t[0]+" "+t[1]+" "+t[2]+" "+t[3]+"\n"+t[4]+" "+t[5]+" "+t[6]+" "+t[7]+"\n"+t[8]+" "+t[9]+" "+t[10]+" "+t[11]+"\n"+t[12]+" "+t[13]+" "+t[14]+" "+t[15]+"\n"}},GIZA.Matrix3={make:function(){if(0==arguments.length)return self.identity();if(3==arguments.length){var t=arguments;return this.make(t[0][0],t[0][1],t[0][2],t[1][0],t[1][1],t[1][2],t[2][0],t[2][1],t[2][2])}if(9==arguments.length)return Array.prototype.slice.call(arguments);if(1==arguments.length){var t=arguments[0];if(9==t.length)return t.slice(0);if(3==t.length)return this.make(t[0][0],t[0][1],t[0][2],t[1][0],t[1][1],t[1][2],t[2][0],t[2][1],t[2][2])}else console.error("GIZA.Matrix3 has wrong number of arguments")},makeBasis:function(t,n,e){return this.make(t[0],t[1],t[2],n[0],n[1],n[2],e[0],e[1],e[2])},copy:function(t){return this.make(t)},identity:function(){return this.make(1,0,0,0,1,0,0,0,1)},equivalent:function(t,n,e){e=e||1e-6;for(var r=0;9>r;r++)if(Math.abs(t[r]-n[r])>e)return!1;return!0},set:function(t,n){for(var e=0;9>e;e++)t[e]=n[e];return t},row:function(t,n){return GIZA.Vector3.make(t[n],t[n+3],t[n+6])},column:function(t,n){return GIZA.Vector3.make(t[3*n],t[3*n+1],t[3*n+2])},multiply:function(t,n){if(3==n.length)return GIZA.Vector3.make(t[0]*n[0]+t[3]*n[1]+t[6]*n[2],t[1]*n[0]+t[4]*n[1]+t[7]*n[2],t[2]*n[0]+t[5]*n[1]+t[8]*n[2]);if(9==n.length){var e=this.row(t,0),r=this.row(t,1),i=this.row(t,2),a=this.column(n,0),o=this.column(n,1),s=this.column(n,2),u=GIZA.Vector3,t=GIZA.Matrix3.make(u.dot(e,a),u.dot(e,o),u.dot(e,s),u.dot(r,a),u.dot(r,o),u.dot(r,s),u.dot(i,a),u.dot(i,o),u.dot(i,s));return this.transposed(t)}throw new Error("I can only multiply a M3 with a V3 or a M3")},rotationX:function(t){var n=Math.cos(t),e=Math.sin(t);return this.make(1,0,0,0,n,-e,0,e,n)},rotationY:function(t){var n=Math.cos(t),e=Math.sin(t);return this.make(n,0,e,0,1,0,-e,0,n)},rotationZ:function(t){var n=Math.cos(t),e=Math.sin(t);return this.make(n,-e,0,e,n,0,0,0,1)},rotateAxis:function(t,n,e){var r=n[0],i=n[1],a=n[2],o=Math.sqrt(r*r+i*i+a*a);r/=o,i/=o,a/=o;var s=r*r,u=i*i,c=a*a,l=Math.cos(e),f=Math.sin(e),h=1-l,m=r*i*h,A=r*a*h,d=i*a*h,v=r*f,g=i*f,I=a*f,G=s+(1-s)*l,Z=m+I,p=A-g,w=m-I,k=u+(1-u)*l,y=d+v,M=A+g,S=d-v,b=c+(1-c)*l,x=t[0],T=t[1],E=t[2],L=t[3],z=t[4],q=t[5],V=t[6],P=t[7],C=t[8];return t[0]=G*x+Z*L+p*V,t[1]=G*T+Z*z+p*P,t[2]=G*E+Z*q+p*C,t[3]=w*x+k*L+y*V,t[4]=w*T+k*z+y*P,t[5]=w*E+k*q+y*C,t[6]=M*x+S*L+b*V,t[7]=M*T+S*z+b*P,t[8]=M*E+S*q+b*C,t},scale:function(t){var n,e,r;return 3==t.length?(n=t[0],e=t[1],r=t[2]):n=e=r=t,this.make(n,0,0,0,e,0,0,0,r)},transpose:function(t){var n=this.transposed(t);return this.set(t,n),t},transposed:function(t){return this.make(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])},stringify:function(t){return t[0]+" "+t[1]+" "+t[2]+"\n"+t[3]+" "+t[4]+" "+t[5]+"\n"+t[6]+" "+t[7]+" "+t[8]+"\n"}};var GIZA=GIZA||{};GIZA.Color3={make:function(t,n,e){return[t,n,e]},equivalent:function(t,n,e){return e=e||1e-6,GIZA.Vector3.distanceSquared(t,n)<e},copy:function(t){return this.make(t[0],t[1],t[2])},set:function(t,n,e){return e=e||1,t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t},hsvToRgb:function(t,n,e){if(0>=n)return this.make(e,e,e);t=6*t;var r=e*n,i=t%2,a=(1-Math.abs(i-1))*r,o=e-r,s=0,u=0,c=0;return 1>t?(s=r,u=a,c=0):2>t?(s=a,u=r,c=0):3>t?(s=0,u=r,c=a):4>t?(s=0,u=a,c=r):5>t?(s=a,u=0,c=r):(s=r,u=0,c=a),this.make(s+o,u+o,c+o)}},GIZA.Color4={make:function(t,n,e,r){return[t,n,e,r]},copy:function(t){return this.make(t[0],t[1],t[2],t[3])},set:function(t,n,e){return e=e||1,t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3],t},hsvToRgb:function(t,n,e){var r=GIZA.Color3.hsvToRgb(t,n,e);return r.push(1),r}};var GIZA=GIZA||{};GIZA.Topo={NONE:0,FACET:1,SMOOTH:2,quadsToTriangles:function(t,n){var e=GIZA.Vector3,r={destIndexType:t.constructor,destPointsType:Float32Array,pointsArray:null,dereference:!1,normals:GIZA.Topo.NONE};n=GIZA.merge(r,n||{});for(var i=new n.destIndexType(6*t.length/4),a=0,o=0;o<t.length;){var s=t[o++],u=t[o++],c=t[o++],l=t[o++];i[a++]=c,i[a++]=u,i[a++]=s,i[a++]=s,i[a++]=l,i[a++]=c}var f=function(t){var r=n.pointsArray[3*t+0],i=n.pointsArray[3*t+1],a=n.pointsArray[3*t+2];return e.make(r,i,a)};if(n.dereference){if(!n.pointsArray)return void console.error("GIZA.Topo: Dereferencing was requested, but pointsArray was not specified.");for(var h=new n.destPointsType(3*i.length),m=0,a=0;a<i.length;a++){var A=i[a];h[m++]=n.pointsArray[3*A+0],h[m++]=n.pointsArray[3*A+1],h[m++]=n.pointsArray[3*A+2]}var d=null;if(n.normals==GIZA.Topo.FACET){d=new Float32Array(h.length);for(var a=0,o=0;o<t.length;)for(var s=t[o++],u=t[o++],c=t[o++],l=t[o++],v=f(s),g=f(u),I=f(c),G=e.direction(v,g),Z=e.direction(v,I),p=e.cross(G,Z),w=0;6>w;w++)d[a++]=p[0],d[a++]=p[1],d[a++]=p[2]}}if(n.normals==GIZA.Topo.SMOOTH){for(var k=[],Z=0;Z<n.pointsArray.length/3;Z++)k.push([]);for(var y=[],o=0;o<t.length;){var s=t[o++],u=t[o++],c=t[o++],l=t[o++];k[s].push(o/4-1),k[u].push(o/4-1),k[c].push(o/4-1),k[l].push(o/4-1);var v=f(s),g=f(u),I=f(c),G=e.direction(v,g),Z=e.direction(v,I),p=e.cross(G,Z);y.push(p)}d=new Float32Array(n.pointsArray.length);for(var a=0,Z=0;Z<n.pointsArray.length/3;Z++){for(var p=e.make(0,0,0),A=0;A<k[Z].length;A++)p=e.add(p,y[k[Z][A]]);e.normalize(p),d[a++]=p[0],d[a++]=p[1],d[a++]=p[2]}}return{indexArray:i,pointsArray:h,normalsArray:d}},quadsToLines:function(t,n){n=n||t.constructor,edgeList={};for(var e=function(t,n){var e=("0000"+t.toString(16)).slice(-4),r=("0000"+n.toString(16)).slice(-4);n>t?edgeList[e+r]=[t,n]:edgeList[r+e]=[n,t]},r=0;r<t.length;){var i=t[r++],a=t[r++],o=t[r++],s=t[r++];e(i,a),e(a,o),e(o,s),e(s,i)}for(var u=Object.keys(edgeList).sort(),c=new n(2*u.length),l=0,f=0;l<u.length;){var h=edgeList[u[l++]];c[f++]=h[0],c[f++]=h[1]}return c},trianglesToLines:function(t,n){n=n||t.constructor,edgeList={};for(var e=function(t,n){var e=("0000"+t.toString(16)).slice(-4),r=("0000"+n.toString(16)).slice(-4);n>t?edgeList[e+r]=[t,n]:edgeList[r+e]=[n,t]},r=0;r<t.length;){var i=t[r++],a=t[r++],o=t[r++];e(i,a),e(a,o),e(o,i)}for(var s=Object.keys(edgeList).sort(),u=new n(2*s.length),c=0,l=0;c<s.length;){var f=edgeList[s[c++]];u[l++]=f[0],u[l++]=f[1]}return u}};var __indexOf=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};GIZA.tessellate=function(t,n){var e,r,i,a,o,s,u,c,l,f,h,m,A,d,v,g,I,G,Z,p,w,k,y,M,S,b,x,T,E,L,z,q,V,P,C,F,R,O,_,N,B,D,U,H,X,W,Y,j,K,J,$,Q=GIZA.Vector2;if(A=function(t,n,e){var r=Q.subtract(e,t),i=Q.subtract(n,t),a=0>Q.cross(r,i);return a},h=function(t,n,e){var r;return t[1]===n[1]?t[0]:t[1]<n[1]?(r=(e-t[1])/(n[1]-t[1]),t[0]+r*(n[0]-t[0])):(r=(e-n[1])/(t[1]-n[1]),n[0]+r*(t[0]-n[0]))},t.length<3)return[];if(3===t.length&&0===n.length)return[0,1,2];if(S=[],k=function(){$=[];for(var n=0,e=t.length;e>=0?e>n:n>e;e>=0?n++:n--)$.push(n);return $}.apply(this),b=0,s=function(n){var e,r,i,a,o,s,u,c,l,f,m,A,d,v,g,I,G,Z,p,w,y,M,b,x,T,E,L,z,q,V,P;for(a=0,b=-1e4,g=x=0,L=n.length;L>x;g=++x)A=n[g],A[0]>b&&(b=A[0],a=g);for(i=n[a],e=1e-4,r=Q.make(1e4,i[1]),o=Q.make(),s=-1,I=T=0,z=t.length;z>T;I=++T)f=t[I],G=(I+1)%t.length,m=t[G],f[0]<i[0]&&m[0]<i[0]||f[0]>r[0]&&m[0]>r[0]||(f[1]<=(V=i[1])&&V<=m[1]||m[1]<=(P=i[1])&&P<=f[1])&&(M=h(f,m,i[1]),M<r[0]&&(r[0]=M,f[0]>m[0]?(o=f,s=I):(o=m,s=G)));for(y=[i,r,o],l=1e3,c=-1,Z=E=0,q=k.length;q>E;Z=++E)if(g=k[Z],S[Z]&&(u=t[g],Q.withinTriangle(u,y[0],y[1],y[2]))){if(v=Math.abs(u[1]-o[1]),d=Math.abs(u[0]-o[0]),0===d)continue;w=v/d,l>w&&(l=w,c=g)}return-1!==c&&(s=c),p=[s,a]},o=function(t){var n,e;return e=(t+k.length-1)%k.length,n=(t+1)%k.length,[e,n]},e=function(n){var e,r,i,a,s,u,c,l,f,h,m,A;if(0===b)return!0;for(A=o(n),c=A[0],u=A[1],l=[c,n,u],a=function(){var t,n,e;for(e=[],t=0,n=l.length;n>t;t++)s=l[t],e.push(k[s]);return e}(),f=function(){var n,r,i;for(i=[],n=0,r=a.length;r>n;n++)e=a[n],i.push(t[e]);return i}(),r=!0,s=h=0,m=k.length;m>h;s=++h)if(i=k[s],!(__indexOf.call(a,i)>=0)&&S[s]&&Q.withinTriangle(t[i],f[0],f[1],f[2])){r=!1;break}return r},d=function(n){var e,r,i,a,s,u;return u=o(n),s=u[0],a=u[1],e=t[k[s]],r=t[k[n]],i=t[k[a]],A(e,r,i)},x=[],n.length&&n[0].length>=3){for(Z=V=0,F=k.length;F>V;Z=++V)v=k[Z],S.push(d(Z));for(c=n[0],x=s(c),t=t.slice(0),l=t.length,P=0,R=c.length;R>P;P++)u=c[P],t.push(u);for(I=[],f=(x[0]+1)%k.length,q=C=0,Y=k.length;Y>=0?Y>C:C>Y;q=Y>=0?++C:--C)I.push(k[f]),f=(f+1)%k.length;for(f=x[1],q=D=0,j=c.length;j>=0?j>D:D>j;q=j>=0?++D:--D)I.push(l+f),f=(f+1)%c.length;I.push(I[k.length]),I.push(I[k.length-1]),k=I}for(r=[],S=[],b=0,Z=U=0,O=k.length;O>U;Z=++U)v=k[Z],d(Z)?(S.push(!0),b+=1):(S.push(!1),r.push(Z));for(a=[],H=0,_=r.length;_>H;H++)Z=r[H],e(Z)&&a.push(Z);for(E=!1,E&&(console.info(""),console.info("ears    "+a),console.info("reflex  "+S),console.info("convex  "+r)),T=[];k.length>0;){for(p=a.pop(),z-=1,K=o(p),y=K[0],w=K[1],M=[y,p,w],G=function(){var t,n,e;for(e=[],n=0,t=M.length;t>n;n++)Z=M[n],e.push(k[Z]);return e}(),T.push(G),k.splice(p,1),S.splice(p,1),f=X=0,N=a.length;N>X;f=++X)Z=a[f],Z>p&&(a[f]=a[f]-1);for(w>p&&(w-=1),y>p&&(y-=1),J=[y,w],W=0,B=J.length;B>W;W++)g=J[W],S[g]&&!d(g)&&(S[g]=!1,b-=1),S[g]||(m=e(g),i=a.indexOf(g),L=-1!==i,m&&!L?a.push(g):!m&&L&&a.splice(i,1))}return T};var GIZA=GIZA||{};GIZA.equations={},GIZA.equations.sphere=function(t){return function(n,e){return n=Math.PI*n,e=2*Math.PI*e,GIZA.Vector3.make(t*Math.sin(n)*Math.cos(e),t*Math.cos(n),t*-Math.sin(n)*Math.sin(e))}},GIZA.equations.plane=function(t){return function(n,e){var r=-t/2+t*n,i=-t/2+t*e;return GIZA.Vector3.make(r,i,0)}},GIZA.equations.sinc=function(t,n,e){var r=GIZA.equations.plane(n);return function(i,a){var o=r(i,a),s=o[0]*t/n,u=o[1]*t/n,c=Math.sqrt(s*s+u*u);return o[2]=e*Math.sin(c)/c,o}},GIZA.equations.torus=function(t,n){return function(e,r){return e=2*Math.PI*e,r=2*Math.PI*r,GIZA.Vector3.make((n+t*Math.cos(r))*Math.cos(e),(n+t*Math.cos(r))*Math.sin(e),t*Math.sin(r))}},GIZA.equations.tube=function(t,n){var e=GIZA.Vector3,r=GIZA.Vector4,i=GIZA.Matrix4;return function(a,o){var s=t(a),u=t(a+.01),c=e.normalize(e.subtract(s,u)),l=e.perp(c),f=e.normalize(e.cross(c,l)),h=i.makeBasis(f,l,c),m=r.make(Math.cos(4*Math.PI*o),Math.sin(4*Math.PI*o),0,0);return m=i.multiply(h,m),m=r.scale(m,n),e.add(m,s)}},GIZA.equations.grannyKnot=function(t){t=2*Math.PI*t;var n=Math.cos,e=Math.sin,r=-.22*n(t)-1.28*e(t)-.44*n(3*t)-.78*e(3*t),i=-.1*n(2*t)-.27*e(2*t)+.38*n(4*t)+.46*e(4*t),a=.7*n(3*t)-.4*e(3*t);return GIZA.Vector3.make(r,i,a)},GIZA.surfaceFlags={POSITIONS:1,COLORS:2,NORMALS:4,WRAP_COLS:8,WRAP_ROWS:16},GIZA.surface=function(t,n,e,r){var i=GIZA.Vector3,a=GIZA.Vector2;if(null==r){var o=GIZA.surfaceFlags;r=o.POSITIONS|o.WRAP_COLS|o.WRAP_ROWS}var s=r&GIZA.surfaceFlags.WRAP_COLS,u=r&GIZA.surfaceFlags.WRAP_ROWS,c=r&GIZA.surfaceFlags.COLORS,l=r&GIZA.surfaceFlags.NORMALS,f=(n+1)*(e+1),h=2*n*e,m=s?e:e+1,A=u?n:n+1,d=m*n+A*e,v=3;l&&(v+=3),c&&v++;return{pointCount:function(){return f},lineCount:function(){return d},triangleCount:function(){return h},points:function(){f>65535&&console.error("Too many points for 16-bit indices");var r={};r.position=[Float32Array,3],l&&(r.normal=[Float32Array,3]),c&&(r.color=[Uint8Array,4]);for(var a=new GIZA.BufferView(r),o=a.makeBuffer(f),s=a.iterator("position"),u=a.iterator("normal"),h=1/e,m=1/n,A=0,d=0;n+1>d;d++){for(var v=0,g=0;e+1>g;g++){var I=t(v,A);if(i.set(s.next(),I),l){var G=i.subtract(t(v+h,A),I),Z=i.subtract(t(v,A+m),I),p=i.normalize(i.cross(Z,G));i.set(u.next(),p)}v=g==e?1:v+h}A=d==n?1:A+m}return o},lines:function(t){t=t||Uint16Array;for(var r=new GIZA.BufferView({line:[t,2]}),i=r.makeBuffer(d),o=r.iterator("line"),s=e+1,u=0;A>u;u++)for(var c=0;e>c;c++){var l=u*s+c;a.set(o.next(),[l,l+1])}for(var u=0;n>u;u++)for(var c=0;m>c;c++){var l=u*s+c;a.set(o.next(),[l,l+s])}return i},triangles:function(t){t=t||Uint16Array;for(var r=new GIZA.BufferView({triangle:[t,3]}),a=r.makeBuffer(h),o=r.iterator("triangle"),s=e+1,u=0;n>u;u++)for(var c=0;e>c;c++){var l=u*s+c,f=l+s,m=l+1,A=l,d=l+s+1;i.set(o.next(),[f,m,A]),i.set(o.next(),[d,m,f])}return a}}};var GIZA=GIZA||{};GIZA.Path={Turtle:function(t,n){var e=[[t,n]];return{getNearest:function(t,n){for(var r=GIZA.Vector2,i=n||40,a=-1,o=0;o<e.length;o++){var s=r.distanceSquared(e[o],t);i>s&&(a=o,i=s)}return a},coords:function(){return e},lineTo:function(t,n){e.push([t,n])},bezierCurveTo:function(t,n,r,i,a,o){e.push([a,o])},closePath:function(){e.push(e[0])},mirror:function(){for(var t=0;t<e.length;t++)e[t]=[e[t][1],e[t][0]]},translate:function(t,n){for(var r=0;r<e.length;r++)e[r][0]+=t,e[r][1]+=n},scale:function(t,n){for(var r=0;r<e.length;r++)e[r][0]*=t,e[r][1]*=n},write:function(t,n){n=n||0;for(var r=0;r<e.length;r++)t[n++]=e[r][0],t[n++]=e[r][1];return n}}},Circle:function(t,n,e){return this instanceof GIZA.Path.Circle?(this.center=t,this.radius=n,this.normal=e,void(this.tessellate=function(e){for(var r=new Float32Array(3*e),i=0,a=2*Math.PI/e,o=0;e>o;o++)r[3*o+0]=t[0]+n*Math.cos(i),r[3*o+1]=t[1]+n*Math.sin(i),r[3*o+2]=0,i+=a;return r})):new GIZA.Path.Circle(t,n,e)}};var GIZA=GIZA||{};GIZA.mouseinit=function(){var t=GIZA,n=GIZA.canvas;t.mouse={position:null,modifiers:{},handlers:[]};var e=function(e){var r=n.getBoundingClientRect(),i=e.clientX-r.left,a=e.clientY-r.top;t.mouse.modifiers.alt=e.altKey,t.mouse.modifiers.shift=e.shiftKey,t.mouse.modifiers.alt=e.altKey,t.mouse.position=[i,a];var o=e.type;"mousedown"==o?t.mouse.modifiers.button=!0:"mouseup"==o&&(t.mouse.modifiers.button=!1);for(var s=0;s<t.mouse.handlers.length;s++){var u=t.mouse.handlers[s];u(o,t.mouse.position,t.mouse.modifiers)}};GIZA._onmouse=e,GIZA._onmouseout=onmouseout,n.addEventListener("mousedown",e),n.addEventListener("mouseup",e),n.addEventListener("mousemove",e),n.addEventListener("mouseenter",e),n.addEventListener("mouseout",onmouseout)},GIZA.mouseshutdown=function(){var t=GIZA.canvas,n=GIZA._onmouse,e=GIZA._onmouseout;GIZA._onmouse=void 0,GIZA._onmouseout=void 0,t.removeEventListener("mousedown",n),t.removeEventListener("mouseup",n),t.removeEventListener("mousemove",n),t.removeEventListener("mouseenter",n),t.removeEventListener("mouseout",e)},GIZA.mousedown=function(t){GIZA.mouse.handlers.push(function(n,e,r){"mousedown"==n&&t(e,r)})},GIZA.mouseup=function(t){GIZA.mouse.handlers.push(function(n,e,r){"mouseup"==n&&t(e,r)})},GIZA.mousemove=function(t){GIZA.mouse.handlers.push(function(n,e,r){"mousemove"==n&&t(e,r)
})};var GIZA=GIZA||{};GIZA.Turntable=function(t){var n=GIZA.Matrix3,e=(GIZA.Vector3,GIZA.Vector2);if(!(this instanceof GIZA.Turntable))return new GIZA.Turntable(t);var r={startSpin:.001,allowTilt:!0,allowSpin:!0,spinFriction:.125,epsilon:3,radiansPerPixel:e.make(.01,.01),canvas:GIZA.canvas,trackpad:!0,lockAxes:!1,homeTilt:.25};this.config=t=GIZA.merge(r,t||{});var i={Resting:0,SpinningStart:1,SpinningInertia:2,DraggingInit:3,DraggingSpin:4,DraggingTilt:5,ReturningHome:6},a=e.make(0,0),o=e.make(0,0),s=o.slice(0),u=o.slice(0),c=0,l=t.homeTilt,f=t.startSpin?i.SpinningStart:i.Resting,h=null,m=0,A=.125,d=this;GIZA.mousedown(function(t){d.startDrag(t)}),GIZA.mouseup(function(t){d.endDrag(t)}),GIZA.mousemove(function(t,n){n.button&&d.updateDrag(t)}),GIZA.drawHooks.push(function(n){null==h&&(h=n);var r=n-h;h=n;var a=f==i.DraggingSpin||f==i.DraggingInit&&!t.lockAxes;f==i.SpinningStart?c+=t.startSpin*r:f==i.SpinningInertia?(c+=m*r,m*=1-t.spinFriction,Math.abs(m)<1e-4&&(f=i.Resting)):t.trackpad&&a&&e.equivalent(o,u,0)&&(c+=m*r,m*=1-t.spinFriction),u=s.slice(0),s=o.slice(0)}),this.startDrag=function(t){a=t.slice(0),o=t.slice(0),f=i.DraggingInit},this.updateDrag=function(n){var r=e.subtract(n,a);if(f==i.DraggingInit&&t.lockAxes)if(Math.abs(r[0])>t.epsilon&&t.allowSpin)f=i.DraggingSpin;else{if(!(Math.abs(r[1])>t.epsilon&&t.allowTilt))return;f=i.DraggingTilt}var s=this.getAngles()[0];o=n.slice(0);var u=this.getAngles()[0]-s;m=A*u},this.getAngles=function(){var n=e.subtract(o,a),r=c,s=l;if(f==i.DraggingSpin){var u=t.radiansPerPixel[0]*n[0];r+=u}else if(f==i.DraggingTilt){var u=t.radiansPerPixel[1]*n[1];s+=u}else t.lockAxes||f!=i.DraggingInit||(r+=t.radiansPerPixel[0]*n[0],s+=t.radiansPerPixel[1]*n[1]);return[r,s]},this.getRotation=function(){var t=this.getAngles(),e=n.rotationY(t[0]),r=n.rotationX(t[1]);return n.multiply(r,e)},this.endDrag=function(n){var e=this.getAngles()[0];o=n.slice(0);var r=this.getAngles();c=r[0],l=r[1];var a=c-e;1==t.spinFriction?f=i.Resting:(f=i.SpinningInertia,m=A*a)}},GIZA.Turntable.INFINITE=1e3,vendors=[null,"webkit","apple","moz","o","xv","ms","khtml","atsc","wap","prince","ah","hp","ro","rim","tc"],vendorName=function(t,n){return null===n?t:n+t[0].toUpperCase()+t.substr(1)},getVendorAttrib=function(t,n,e){var r,i,a,o,s;if(t)for(o=0,s=vendors.length;s>o;o++)if(a=vendors[o],i=vendorName(n,a),r=t[i],void 0!==r)return r;return e},document.fullscreenEnabled=getVendorAttrib(document,"fullscreenEnabled"),document.cancelFullscreen=getVendorAttrib(document,"cancelFullScreen"),GIZA.requestFullscreen=function(t){null==t&&(t=this.canvas),t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen():t.oRequestFullScreen&&t.oRequestFullScreen()},GIZA.isFullscreen=function(){var t,n;return t=getVendorAttrib(document,"fullscreenElement"),n=getVendorAttrib(document,"fullScreenElement"),t||n},GIZA.onFullscreenChange=function(t){var n,e,r,i,a=this;for(n=function(){return t(a.isFullscreen())},r=0,i=vendors.length;i>r;r++)e=vendors[r],document.addEventListener(e+"fullscreenchange",n,!1)},GIZA.exitFullscreen=function(){document.cancelFullscreen()},GIZA.toggleFullscreen=function(t){return t=t||this.canvas,this.isFullscreen()?this.exitFullscreen():this.requestFullscreen(t)};